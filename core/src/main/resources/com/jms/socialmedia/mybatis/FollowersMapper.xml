<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jms.socialmedia.mybatis.FollowersMapper">

    <select id="getFollowerUserIds" parameterType="int" resultType="Integer">
		select follower_user_id from followers
		where following_user_id = #{id}
	</select>

	<sql id="getFollowingUserIdsSQL">
		select following_user_id from followers
		where follower_user_id = #{id}
	</sql>

	<select id="getFollowingUserIds" parameterType="int" resultType="Integer">
		<include refid="getFollowingUserIdsSQL"></include>
	</select>

	<insert id="followUser" databaseId="oracle">
		insert into followers (follower_user_id, following_user_id, timestamp) values (
            #{param1}, #{param2}, systimestamp
        )
	</insert>

	<insert id="followUser">
		insert into followers (follower_user_id, following_user_id, timestamp) values (
            #{param1}, #{param2}, now()
        )
	</insert>

	<delete id="unfollowUser">
        delete from followers
        where follower_user_id = #{param1} and following_user_id = #{param2}
    </delete>

	<select id="getUsersToFollow" parameterType="Integer" resultType="User">
		select user_id, username from users
		where user_id != #{id}
		and user_id not in
		(<include refid="getFollowingUserIdsSQL"></include>)
	</select>
</mapper>